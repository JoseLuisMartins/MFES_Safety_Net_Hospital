\begin{vdmpp}[breaklines=true]
class SystemTest is subclass of MyTestCase
types
-- TODO Define types here
values
-- TODO Define values here
instance variables
  
  private safetyNet: SafetyNetNetwork := SafetyNetNetwork`getInstance();

operations


(*@
\label{main:13}
@*)
public static main: () ==> ()
main() == (
 
  dcl systemTest: SystemTest := new SystemTest();
 
  IO`println("network ");
 
  -- association hospital - doctor 
  IO`print("test associateADoctorToAnHospital -> ");
  systemTest.testAssociateDoctorToAnHospital();
  IO`println("Success");
  
  IO`print("test disassociateADoctorToAnHospital -> ");
  systemTest.testDisassociateDoctorToAnHospital();
  IO`println("Success");
  
  
  -- Hospital
  IO`print("test addHospital -> ");
  systemTest.testAddHospital();
  IO`println("Success");

  IO`print("test removeHospital -> ");
  systemTest.testRemoveHospital();
  IO`println("Success");
  
  IO`print("test getAllHospitalsByLocation -> ");
  systemTest.testGetHospitalsByLocation();
  IO`println("Success");
  
  IO`print("test getAllHospitals -> ");
  systemTest.testGetAllHospitals();
  IO`println("Success");
  
  IO`print("test getHospitalsByName -> ");
  systemTest.testGetHospitalsByName();
  IO`println("Success");
  
  IO`print("test getHospitalsById -> ");
  systemTest.testGetHospitalsById();
  IO`println("Success");
  
  IO`print("test getHospitalsByAgreement -> ");
  systemTest.testGetHospitalsByAgreement();
  IO`println("Success");
  
  IO`print("test getHospitalBySpecialtie -> ");
  systemTest.testGetHospitalBySpecialtie();
  IO`println("Success");
  
  IO`print("test getHospitalSpecialties -> ");
  systemTest.testGetHospitalSpecialties();
  IO`println("Success");

  -- Doctor
  IO`print("test addDoctor -> ");
  systemTest.testAddDoctor();
  IO`println("Success");
  
  IO`print("test getDoctors -> ");
  systemTest.testGetAllDoctors();
  IO`println("Success");
  
  IO`print("test removeDoctor -> ");
  systemTest.testRemoveDoctor();
  IO`println("Success");
  
  IO`print("test getDoctorHospitals -> ");
  systemTest.testGetDoctorHospitals();
  IO`println("Success");
  
  IO`print("test getDoctorBySpecialtie-> ");
  systemTest.testGetDoctorBySpecialtie();
  IO`println("Success");
  
  IO`print("test getDoctorById -> ");
  systemTest.testGetDoctorById();
  IO`println("Success");
  
  -- Patient
  IO`print("test addPatient -> ");
  systemTest.testAddPatient();
  IO`println("Success");
  
  IO`print("test removePatient -> ");
  systemTest.testRemovePatient();
  IO`println("Success");
  
  IO`print("test addObservation -> ");
  systemTest.testAddObservation();
  IO`println("Success");
  
  IO`print("test getPatientById -> ");
  systemTest.testGetPatientById();
  IO`println("Success");
  
  
  -- Appointement
  
  IO`print("test addAppointment -> ");
  systemTest.testAddAppointment();
  IO`println("Success");
    
  IO`print("test removeAppointment -> ");
  systemTest.testRemoveAppointment();
  IO`println("Success");
  
  IO`print("test getSpecialtyAppointments -> ");
  systemTest.testGetSpecialtyAppointments();
  IO`println("Success");
  
  IO`print("test getHospitalClosestAvailableDate -> ");
  systemTest.testGetHospitalClosestAvailableDate();
  IO`println("Success");
  
  IO`print("test getNextAppointmentDate -> ");
  systemTest.testGetNextAppointmentDate();
  IO`println("Success");
  
  -- Agreement
  
  IO`print("test addAgreement-> ");
  systemTest.testAddAgreement();
  IO`println("Success");
(*@
\label{testAddDoctor:137}
@*)
    
  IO`print("test removeAgreement -> ");
  systemTest.testRemoveAgreement();
  IO`println("Success");
   
);


private testAddDoctor: () ==> ()
 testAddDoctor () == (
 
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  
  assertEqual(doc1.getName(), "jose");
  assertEqual(doc2.getName(), "marcelo");
  
  assertEqual(doc1.getAge(), 35);
  assertEqual(doc2.getAge(), 40); 
  
  assertEqual(doc1.getSpecialty(), <ORTOPEDIA>);
(*@
\label{testGetAllDoctors:163}
@*)
  assertEqual(doc2.getSpecialty(), <CARDIOLOGIA>);
  
  assertEqual( safetyNet.getDoctors(), {doc1.getId() |-> doc1, doc2.getId() |->doc2});
  
  safetyNet.clearInstance();
    
);

private testGetAllDoctors: () ==> ()
 testGetAllDoctors () == (
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();

  assertEqual(rng safetyNet.getDoctors(), {});
   
  safetyNet.addDoctor(doc1);
(*@
\label{testRemoveDoctor:182}
@*)
  safetyNet.addDoctor(doc2);

  assertEqual( safetyNet.getDoctors(), {doc1.getId() |-> doc1, doc2.getId() |->doc2});
  
  safetyNet.clearInstance();
    
);

private testRemoveDoctor: () ==> ()
 testRemoveDoctor () == (
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
   
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  
  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
  
  safetyNet.removeDoctor(doc2);

  -- check if was removed from the system
  assertEqual( safetyNet.getDoctors(), {doc1.getId() |-> doc1});
  
(*@
\label{testAddHospital:215}
@*)
  -- check if the doctor was removed from all hospitals where he worked
  for all hs in set rng safetyNet.getHospitals() do
   assertFalse(doc2.getId() in set hs.getDoctorsIds());
  
  safetyNet.clearInstance();
    
);

private testAddHospital: () ==> ()
 testAddHospital () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
(*@
\label{testRemoveHospital:232}
@*)
  safetyNet.addHospital(hos2);
  
  assertEqual(safetyNet.getHospitals(), { hos1.getId() |-> hos1, hos2.getId() |-> hos2});
  
  safetyNet.clearInstance();
    
);

private testRemoveHospital: () ==> ()
 testRemoveHospital () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);

  safetyNet.removeHospital(hos1);
(*@
\label{testAssociateDoctorToAnHospital:252}
@*)

  assertEqual(safetyNet.getHospitals(), { hos2.getId() |-> hos2});
  
  safetyNet.clearInstance();
    
);


private testAssociateDoctorToAnHospital: () ==> ()
 testAssociateDoctorToAnHospital () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>}); 
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
  
  assertEqual(hos1.getDoctorsIds(), {doc1.getId()});
(*@
\label{testGetHospitalBySpecialtie:282}
@*)
(*@
\label{testDisassociateDoctorToAnHospital:282}
@*)
  assertEqual(hos2.getDoctorsIds(), {doc1.getId(),doc2.getId()});

  assertEqual( safetyNet.getDoctors(), {doc1.getId() |-> doc1, doc2.getId() |->doc2});
  
  safetyNet.clearInstance();
    
);

private testGetHospitalBySpecialtie: () ==> ()
 testGetHospitalBySpecialtie () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>}); 
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  
  dcl aux: set of ModelUtils`Specialty := {<ORTOPEDIA>, <CARDIOLOGIA>, <OFTALMOLOGIA>, <DERMATOLOGIA>, <GINECOLOGIA>, <NEUROLOGIA>, <PEDIATRIA>, <REUMATOLOGIA>, <UROLOGIA>, <PNEUMOLOGIA>};
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
  
  assertEqual(safetyNet.getHospitalsBySpecialty(<ORTOPEDIA>), {hos1, hos2});
  assertEqual(safetyNet.getHospitalsBySpecialty(<CARDIOLOGIA>), {hos2});
(*@
\label{testGetHospitalsByLocation:315}
@*)
  
  for all s in set aux do (
   if ((s <> <ORTOPEDIA>) and (s <> <CARDIOLOGIA>)) then
    assertEqual(safetyNet.getHospitalsBySpecialty(s), {});
  );
  
  safetyNet.clearInstance();
 
 );


private testDisassociateDoctorToAnHospital: () ==> ()
 testDisassociateDoctorToAnHospital () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});  
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
(*@
\label{testGetHospitalsByAgreement:334}
@*)
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
  
  
  safetyNet.disassociateDoctorFromHospital(hos2.getId(), doc1.getId());

  assertEqual(hos1.getDoctorsIds(), {doc1.getId()});
  assertEqual(hos2.getDoctorsIds(), {doc2.getId()});
  
  assertEqual( safetyNet.getDoctors(), {doc1.getId() |-> doc1, doc2.getId() |->doc2});
  
(*@
\label{testGetHospitalsById:355}
@*)
  safetyNet.clearInstance();
    
);

private testGetHospitalsByLocation: () ==> ()
 testGetHospitalsByLocation () == (
   
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  dcl hos3: Hospital := new Hospital("Hospital de Santo Antonio",mk_ModelUtils`Location("Lisboa", "Avenida de Santo antonio, n� 300","4750-559"), {<ADSE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  safetyNet.addHospital(hos3);
 
  assertEqual(safetyNet.getHospitalsByCity("Porto"), {hos1});
  assertEqual(safetyNet.getHospitalsByCity("Lisboa"), {hos2, hos3});
 
(*@
\label{testGetAllHospitals:375}
@*)
  safetyNet.clearInstance();
);

private testGetHospitalsByAgreement: () ==> ()
 testGetHospitalsByAgreement () == (
   
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  dcl hos3: Hospital := new Hospital("Hospital de Santo Antonio",mk_ModelUtils`Location("Lisboa", "Avenida de Santo antonio, n� 300","4750-559"), {<ADSE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  safetyNet.addHospital(hos3);
 
  assertEqual(safetyNet.getHospitalsByAgreement(<ADSE>), {hos1, hos2, hos3});
  assertEqual(safetyNet.getHospitalsByAgreement(<MEDIS>), {hos2});
(*@
\label{testGetHospitalsByName:393}
@*)
  assertEqual(safetyNet.getHospitalsByAgreement(<MULTICARE>), {hos2});
  assertEqual(safetyNet.getHospitalsByAgreement(<MEDICARE>), {hos1});
  
  safetyNet.clearInstance();
);

private testGetHospitalsById: () ==> ()
 testGetHospitalsById () == (
   
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  dcl hos3: Hospital := new Hospital("Hospital de Santo Antonio",mk_ModelUtils`Location("Lisboa", "Avenida de Santo antonio, n� 300","4750-559"), {<ADSE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  safetyNet.addHospital(hos3);
 
  assertEqual(safetyNet.getHospitalsById(hos1.getId()), hos1);
(*@
\label{testGetDoctorHospitals:413}
@*)
  assertEqual(safetyNet.getHospitalsById(hos2.getId()), hos2);
  assertEqual(safetyNet.getHospitalsById(hos3.getId()), hos3);
 
  safetyNet.clearInstance();
);

private testGetAllHospitals: () ==> ()
 testGetAllHospitals () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  dcl hos3: Hospital := new Hospital("Hospital de Santo Antonio",mk_ModelUtils`Location("Lisboa", "Avenida de Santo antonio, n� 300","4750-559"), {<ADSE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  safetyNet.addHospital(hos3);
 
  assertEqual(safetyNet.getHospitals(), {hos1.getId() |-> hos1, hos2.getId() |-> hos2, hos3.getId() |->hos3});
 
  safetyNet.clearInstance();
);

private testGetHospitalsByName: () ==> ()
 testGetHospitalsByName () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  dcl hos3: Hospital := new Hospital("Hospital de Santo Antonio",mk_ModelUtils`Location("Lisboa", "Avenida de Santo antonio, n� 300","4750-559"), {<ADSE>});
  
(*@
\label{testGetDoctorBySpecialtie:444}
@*)
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  safetyNet.addHospital(hos3);
 
  assertEqual(safetyNet.getHospitalsByName("Hospital Sao Joao"), {hos1});
  assertEqual(safetyNet.getHospitalsByName("Hospital da Luz Lisboa"), {hos2});
  assertEqual(safetyNet.getHospitalsByName("Hospital de Santo Antonio"), {hos3});
  
  safetyNet.clearInstance();
);

private testGetDoctorHospitals: () ==> ()
 testGetDoctorHospitals () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
(*@
\label{testGetHospitalSpecialties:465}
@*)
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());

  assertEqual(safetyNet.getDoctorHospitals(doc1.getId()), {hos1, hos2});
  assertEqual(safetyNet.getDoctorHospitals(doc2.getId()), {hos2});
  assertEqual(safetyNet.getDoctorHospitals(doc3.getId()), {});  
  
  safetyNet.clearInstance();
    
);

private testGetDoctorBySpecialtie: () ==> ()
 testGetDoctorBySpecialtie () == (
 
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
(*@
\label{testGetDoctorById:495}
@*)
  safetyNet := SafetyNetNetwork`getInstance();
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);

  assertEqual(safetyNet.getDoctorsBySpecialty(<ORTOPEDIA>), {doc1});
  assertEqual(safetyNet.getDoctorsBySpecialty(<OFTALMOLOGIA>), {});
  assertEqual(safetyNet.getDoctorsBySpecialty(<CARDIOLOGIA>), {doc2, doc3});  
  
  safetyNet.clearInstance();
    
);

private testGetHospitalSpecialties: () ==> ()
 testGetHospitalSpecialties () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
(*@
\label{testAddPatient:515}
@*)
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());

  assertEqual(safetyNet.getHospitalSpecialties(hos1.getId()), {<ORTOPEDIA>});
  assertEqual(safetyNet.getHospitalSpecialties(hos2.getId()), {<ORTOPEDIA>, <CARDIOLOGIA>});  
  
  safetyNet.clearInstance();
    
);
(*@
\label{testRemovePatient:538}
@*)

private testGetDoctorById: () ==> ()
 testGetDoctorById () == (
   
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);
  
  assertEqual(safetyNet.getDoctorById(doc1.getId()), doc1);
  assertEqual(safetyNet.getDoctorById(doc2.getId()), doc2);
  assertEqual(safetyNet.getDoctorById(doc3.getId()), doc3);
 
  safetyNet.clearInstance();
(*@
\label{testAddAppointment:557}
@*)
);

private testAddPatient: () ==> ()
 testAddPatient () == (
 
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
   
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);
  
  assertEqual(pat1.getName(), "Susana");
  assertEqual(pat2.getName(), "Maria");
  
  assertEqual(pat1.getAge(), 26);
  assertEqual(pat2.getAge(), 38); 

  assertEqual( safetyNet.getPatients(), {pat1.getId() |-> pat1, pat2.getId() |-> pat2});
  
  safetyNet.clearInstance();
    
);

private testRemovePatient: () ==> ()
 testRemovePatient () == (
 
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
   
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);
  
  safetyNet.removePatient(pat2);

  assertEqual( safetyNet.getPatients(), {pat1.getId() |-> pat1});
  
  safetyNet.clearInstance();
    
);

(*@
\label{testGetPatientById:601}
@*)
private testGetPatientById: () ==> ()
 testGetPatientById () == (
   
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);
  
  assertEqual(safetyNet.getPatientById(pat1.getId()), pat1);
  assertEqual(safetyNet.getPatientById(pat2.getId()), pat2);
 
  safetyNet.clearInstance();
);

private testAddAppointment: () ==> ()
 testAddAppointment () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
  
  dcl dt1: set of ModelUtils`Date := {};
  dcl dt2: set of ModelUtils`Date := {};
  
  dcl pt1: set of ModelUtils`Date := {};
  dcl pt2: set of ModelUtils`Date := {};
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);
  
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());

  assertEqual(card safetyNet.getDoctorAppointments(doc1.getId()), 0);
  assertEqual(card safetyNet.getDoctorAppointments(doc2.getId()), 0);

  safetyNet.addAppointment(new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos1.getId(), doc1.getId(), pat1.getId()));
  safetyNet.addAppointment(new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos2.getId(), doc2.getId(), pat2.getId()));

  -- doctor appointments
  assertEqual(card safetyNet.getDoctorAppointments(doc1.getId()), 1);
  for all a in set safetyNet.getDoctorAppointments(doc1.getId()) do (
   dt1 := dt1 union {a.getDate()};
   assertEqual(a.getDoctorId(), doc1.getId());
(*@
\label{testRemoveAppointment:664}
@*)
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
  assertEqual(card dt1, card safetyNet.getDoctorAppointments(doc1.getId()));
  
  assertEqual(card safetyNet.getDoctorAppointments(doc2.getId()), 1);
  for all a in set safetyNet.getDoctorAppointments(doc2.getId()) do (
   dt2 := dt2 union {a.getDate()};
   assertEqual(a.getDoctorId(), doc2.getId());
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
  assertEqual(card dt2, card safetyNet.getDoctorAppointments(doc2.getId()));
  
  
  assertEqual(card safetyNet.getDoctorAppointments(doc3.getId()), 0);
  
  
  -- patient appointments
  assertEqual(card safetyNet.getPatientAppointments(pat1.getId()), 1);
  for all a in set safetyNet.getPatientAppointments(pat1.getId()) do (
   pt1 := pt1 union {a.getDate()};
   assertEqual(a.getPatientId(), pat1.getId());
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
  assertEqual(card pt1, card safetyNet.getPatientAppointments(pat1.getId()));
  
  
  assertEqual(card safetyNet.getPatientAppointments(pat2.getId()), 1);
  for all a in set safetyNet.getPatientAppointments(pat2.getId()) do (
   pt2 := pt2 union {a.getDate()};
   assertEqual(a.getPatientId(), pat2.getId());
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
  assertEqual(card pt2, card safetyNet.getPatientAppointments(pat2.getId()));
  
  -- system
  assertEqual(card safetyNet.getAppointments(), 2);
  
  -- hospital
  assertEqual(safetyNet.getHospitalNumberOfAppointments(hos1.getId()), 1);
  for all a in set safetyNet.getHospitalAppointments(hos1.getId()) do (
   pt1 := pt1 union {a.getDate()};
   assertEqual(a.getHospitalId(), hos1.getId());
   assertTrue(a.getDoctorId() in set hos1.getDoctorsIds());
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
   
  assertEqual(safetyNet.getHospitalNumberOfAppointments(hos2.getId()), 1);  
  for all a in set safetyNet.getHospitalAppointments(hos2.getId()) do (
   pt1 := pt1 union {a.getDate()};
   assertEqual(a.getHospitalId(), hos2.getId());
   assertTrue(a.getDoctorId() in set hos2.getDoctorsIds());
   assertTrue(a.getDate().year > 2017 and a.getDate().month <= 12 and a.getDate().day < 31 and a.getDate().hour < 24 and a.getDate().min < 60);
  );
  
  
  safetyNet.clearInstance();
    
);


 
private testRemoveAppointment: () ==> ()
 testRemoveAppointment () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
  
  dcl app1: Appointment;
  dcl app2: Appointment;
  dcl app3: Appointment;
  dcl app4: Appointment;
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);
  
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());

  assertEqual(card safetyNet.getDoctorAppointments(doc1.getId()), 0);
  assertEqual(card safetyNet.getDoctorAppointments(doc2.getId()), 0);

  app1 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos1.getId(), doc1.getId(), pat1.getId());
  app2 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos2.getId(), doc2.getId(), pat2.getId());

  
  -- add Appointment (app1, app2)
  safetyNet.addAppointment(app1);
  safetyNet.addAppointment(app2);


  -- remove Appointment
  assertTrue(app2 in set safetyNet.getAppointments());
  
  safetyNet.removeAppointment(app2);
  
  assertTrue(app2 not in set safetyNet.getAppointments());
  
  -- verification of data
  
  -- doctor appointments
  assertEqual(safetyNet.getDoctorAppointments(doc1.getId()), {app1});
  assertEqual(safetyNet.getDoctorAppointments(doc2.getId()), {});
  assertEqual(safetyNet.getDoctorAppointments(doc3.getId()), {});
(*@
\label{testAddAgreement:784}
@*)
  
  -- patient appointments
  assertEqual(safetyNet.getPatientAppointments(pat1.getId()), {app1});
  assertEqual(safetyNet.getPatientAppointments(pat2.getId()), {});

  -- system
  assertEqual(card safetyNet.getAppointments(), 1);
  assertEqual(safetyNet.getAppointments(), {app1});
  
  -- hospital
  assertEqual(safetyNet.getHospitalNumberOfAppointments(hos1.getId()), 1);
  assertEqual(safetyNet.getHospitalNumberOfAppointments(hos2.getId()), 0);  


  -- remove a doctor and all his appointments
  app3 := new Appointment(mk_ModelUtils`Date(2018,01,21,8,30), hos2.getId(), doc2.getId(), pat1.getId());
  safetyNet.addAppointment(app3);
  
  safetyNet.removeDoctor(doc2);
  
  assertEqual(safetyNet.getAppointments(), {app1}); 
(*@
\label{testRemoveAgreement:805}
@*)
  
  
  -- remove a patient and all his appointments
  
  safetyNet.addDoctor(doc2);
  
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
    
  app2 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos2.getId(), doc2.getId(), pat2.getId());
  app4 := new Appointment(mk_ModelUtils`Date(2018,01,15,8,30), hos2.getId(), doc1.getId(), pat1.getId());
  
  safetyNet.addAppointment(app2);
  safetyNet.addAppointment(app4);
  
  safetyNet.removePatient(pat1);
  
  assertEqual(safetyNet.getAppointments(), {app2}); 
  
  safetyNet.removeAppointment(app2);
  
(*@
\label{testAddObservation:825}
@*)
  -- remove an hospital and all his appointments
  
  safetyNet.addPatient(pat1);
  safetyNet.addAppointment(app1);
  safetyNet.addAppointment(app2);
  safetyNet.addAppointment(app3);
  safetyNet.addAppointment(app4);
  
  assertEqual(safetyNet.getAppointments(), {app1, app2, app3, app4}); 
  
  safetyNet.removeHospital(hos2);
  
  assertEqual(safetyNet.getAppointments(), {app1});
  
  assertTrue(forall a in set safetyNet.getAppointments() & a.getHospitalId() <> hos2.getId()); 
  
  safetyNet.clearInstance();
    
);

private testAddAgreement: () ==> ()
 testAddAgreement () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
(*@
\label{testGetSpecialtyAppointments:850}
@*)
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  assertEqual(hos1.getAgreements(), {<ADSE>,<MEDICARE>});
  
  safetyNet.addAgreementToHospital(hos1.getId(),<MULTICARE>);
  
  assertEqual(hos1.getAgreements(), {<ADSE>,<MEDICARE>, <MULTICARE>});
  
  safetyNet.clearInstance();
    
);

private testRemoveAgreement: () ==> ()
 testRemoveAgreement () == (
  
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.removeAgreementFromHospital(hos1.getId(),<ADSE>);
  
  assertEqual(hos1.getAgreements(), {<MEDICARE>});
  
  safetyNet.clearInstance();
    
);


private testAddObservation: () ==> ()
 testAddObservation () == (
  
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doenca pulmonar");
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);

  assertEqual(pat1.getClinicalObservations(), ["Gripe"]);
  assertEqual(pat2.getClinicalObservations(), ["Doenca pulmonar"]);
  
  safetyNet.addClinicalObservation(pat1.getId(), "Pneumonia");
  safetyNet.addClinicalObservation(pat1.getId(), "Varicela");

  assertEqual(pat1.getClinicalObservations(), ["Gripe", "Pneumonia", "Varicela"]);
(*@
\label{testGetHospitalClosestAvailableDate:904}
@*)
  assertEqual(pat2.getClinicalObservations(), ["Doenca pulmonar"]); 
   
  safetyNet.clearInstance();
    
);


private testGetSpecialtyAppointments: () ==> ()
 testGetSpecialtyAppointments () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
  
  dcl app1: Appointment;
  dcl app2: Appointment;
  dcl app3: Appointment;
  dcl app4: Appointment;
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);
  
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());

  app1 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos1.getId(), doc1.getId(), pat1.getId());
  app2 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos2.getId(), doc2.getId(), pat2.getId());
  app3 := new Appointment(mk_ModelUtils`Date(2018,01,21,8,30), hos2.getId(), doc2.getId(), pat1.getId());
  app4 := new Appointment(mk_ModelUtils`Date(2018,01,15,8,30), hos2.getId(), doc1.getId(), pat1.getId());
    
  -- add Appointment
  safetyNet.addAppointment(app1);
  safetyNet.addAppointment(app2);
  safetyNet.addAppointment(app3);
  safetyNet.addAppointment(app4);
  
  assertEqual(safetyNet.getSpecialtyAppointments(<ORTOPEDIA>), {app1, app4});
  assertEqual(safetyNet.getSpecialtyAppointments(<CARDIOLOGIA>), {app2, app3});
  assertEqual(safetyNet.getSpecialtyAppointments(<GINECOLOGIA>), {});
  
  
  safetyNet.clearInstance();
    
);
(*@
\label{testGetNextAppointmentDate:964}
@*)

private testGetHospitalClosestAvailableDate: () ==> ()
 testGetHospitalClosestAvailableDate () == (
 
  dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,<MEDICARE>});
  dcl hos2: Hospital := new Hospital("Hospital da Luz Lisboa",mk_ModelUtils`Location("Lisboa", "Avenida Lusíada, nº 100","4700-959"), {<ADSE>,<MEDIS>, <MULTICARE>});
  
  dcl doc1: Doctor := new Doctor("jose",35,<ORTOPEDIA>);
  dcl doc2: Doctor := new Doctor("marcelo", 40 ,<CARDIOLOGIA>);
  dcl doc3: Doctor := new Doctor("joaquim",50,<CARDIOLOGIA>);
  
  dcl pat1: Patient := new Patient("Susana", 26, "Gripe");
  dcl pat2: Patient := new Patient("Maria", 38, "Doença pulmonar");
  
  dcl app1: Appointment;
  dcl app2: Appointment;
(*@
\label{testForogotToAddDoctor:980}
@*)
  dcl app3: Appointment;
  dcl app4: Appointment;
  
(*@
\label{testFailForgotToAddDoctor:983}
@*)
  dcl res: ModelUtils`Date_DoctorId;
  
  safetyNet := SafetyNetNetwork`getInstance();
   
  safetyNet.addHospital(hos1);
  safetyNet.addHospital(hos2);
  
  safetyNet.addDoctor(doc1);
  safetyNet.addDoctor(doc2);
  safetyNet.addDoctor(doc3);
  
  safetyNet.addPatient(pat1);
  safetyNet.addPatient(pat2);

  safetyNet.associateDoctorToHospital(hos1.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc1.getId());
  safetyNet.associateDoctorToHospital(hos2.getId(), doc2.getId());
  safetyNet.associateDoctorToHospital(hos1.getId(), doc3.getId());
(*@
\label{testForgotToAddHospital:1001}
@*)
(*@
\label{testFailForgotToAddHospital:1001}
@*)
  safetyNet.associateDoctorToHospital(hos2.getId(), doc3.getId());
  
    
  app1 := new Appointment(mk_ModelUtils`Date(2018,01,01,8,30), hos2.getId(), doc1.getId(), pat1.getId());
  app2 := new Appointment(mk_ModelUtils`Date(2018,01,01,8,30), hos2.getId(), doc2.getId(), pat2.getId());
  app3 := new Appointment(mk_ModelUtils`Date(2018,01,01,9,00), hos1.getId(), doc1.getId(), pat1.getId());
  app4 := new Appointment(mk_ModelUtils`Date(2018,01,01,9,30), hos2.getId(), doc2.getId(), pat2.getId());

    
  -- add Appointment
  safetyNet.addAppointment(app1);
  safetyNet.addAppointment(app2);
  safetyNet.addAppointment(app3);
  safetyNet.addAppointment(app4);
 
 
  res := safetyNet.getClosestAvailableDate({doc1.getId(), doc2.getId()}); 
  assertEqual(res, mk_ModelUtils`Date_DoctorId(mk_ModelUtils`Date(2018,1,1,9,00), doc2.getId()));
  
(*@
\label{testFailCanNotRemoveAnAgreement:1020}
@*)
(*@
\label{testCanNotRemoveAnAgreement:1020}
@*)
  res := safetyNet.getClosestAvailableDate({doc1.getId(), doc2.getId(),doc3.getId()}); 
  assertEqual(res, mk_ModelUtils`Date_DoctorId(mk_ModelUtils`Date(2018,1,1,8,30), doc3.getId()));
  
  
  safetyNet.clearInstance(); 
);


private testGetNextAppointmentDate: () ==> ()
 testGetNextAppointmentDate () == (
 
  -- next day
  assertEqual(Appointment`getNextAppointmentDate(mk_ModelUtils`Date(2018,12,12,23,45)) ,mk_ModelUtils`Date(2018,12,13,0,15));
  -- next year
  assertEqual(Appointment`getNextAppointmentDate(mk_ModelUtils`Date(2018,12,30,23,45)) ,mk_ModelUtils`Date(2019,1,1,0,15));
  -- next month
  assertEqual(Appointment`getNextAppointmentDate(mk_ModelUtils`Date(2018,10,30,23,45)) ,mk_ModelUtils`Date(2018,11,1,0,15));
  -- next 30 min
  assertEqual(Appointment`getNextAppointmentDate(mk_ModelUtils`Date(2018,10,15,10,30)) ,mk_ModelUtils`Date(2018,10,15,11,0));
(*@
\label{testFailSearchForADoctor:1039}
@*)
 
);

/*

 Tests containing invalid inputs (should be tested one at a time)
*/

public testFailForgotToAddDoctor: () ==> ()
 testFailForgotToAddDoctor () == (*@\vdmnotcovered{(}@*)
 
   dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro",(*@\vdmnotcovered{"4200-319"}@*)), {(*@\vdmnotcovered{<ADSE>}@*),(*@\vdmnotcovered{<MEDICARE>}@*)});
   dcl doc1: Doctor := new Doctor("jose",35,(*@\vdmnotcovered{<ORTOPEDIA>}@*));
   
(*@
\label{testFailDisassociatingADoctorFromAnHospital:1053}
@*)
(*@
\label{testFailDisassoatingADoctorFromAnHospital:1053}
@*)
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
   
   safetyNet := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
   safetyNet.addHospital((*@\vdmnotcovered{hos1}@*));
    
   -- you can not associate a doctor to an hospital if that doctor was not added to the network 
   (*@\vdmnotcovered{safetyNet}@*).associateDoctorToHospital(hos1.getId(), doc1.(*@\vdmnotcovered{getId}@*)());
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
);
 
 
 public testFailForgotToAddHospital: () ==> ()
  testFailForgotToAddHospital () == (*@\vdmnotcovered{(}@*)
  
    dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {<ADSE>,(*@\vdmnotcovered{<MEDICARE>}@*)});
   dcl doc1: Doctor := new Doctor("jose",(*@\vdmnotcovered{35}@*),(*@\vdmnotcovered{<ORTOPEDIA>}@*));
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();   
   
   (*@\vdmnotcovered{safetyNet}@*) := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
   (*@\vdmnotcovered{safetyNet}@*).addDoctor((*@\vdmnotcovered{doc1}@*));
(*@
\label{testFailCreatingAnAppointment:1077}
@*)
    
   -- you can not associate a doctor to an hospital if that hospital was not added to the network 
   safetyNet.associateDoctorToHospital(hos1.getId(), (*@\vdmnotcovered{doc1}@*).(*@\vdmnotcovered{getId}@*)());
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
  
  );
 
 
 public testFailCanNotRemoveAnAgreement: () ==> ()
  testFailCanNotRemoveAnAgreement () == (*@\vdmnotcovered{(}@*)
  
    dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", (*@\vdmnotcovered{"Alameda Prof. Hernâni Monteiro"}@*),"4200-319"), (*@\vdmnotcovered{\{}@*)(*@\vdmnotcovered{<ADSE>}@*),(*@\vdmnotcovered{<MEDICARE>}@*)});
   
    (*@\vdmnotcovered{safetyNet}@*).clearInstance();
    
    safetyNet := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
   (*@\vdmnotcovered{safetyNet}@*).addHospital((*@\vdmnotcovered{hos1}@*));
   
   -- it is not possible to remove an agreement from an hospital if that agreement didn't exist already
   (*@\vdmnotcovered{safetyNet}@*).removeAgreementFromHospital(hos1.getId(),(*@\vdmnotcovered{<MEDIS>}@*));
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
   
  );
  
  
 
  public testFailSearchForADoctor: () ==> ()
   testFailSearchForADoctor () == (*@\vdmnotcovered{(}@*)
   
    dcl doc1: Doctor := new (*@\vdmnotcovered{Doctor}@*)("jose",(*@\vdmnotcovered{35}@*),(*@\vdmnotcovered{<ORTOPEDIA>}@*));
   dcl doc2: Doctor;
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
   
   safetyNet := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
   (*@\vdmnotcovered{doc2}@*) := safetyNet.(*@\vdmnotcovered{getDoctorById}@*)(doc1.(*@\vdmnotcovered{getId}@*)());
   
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
   
  );
  
  
  public testFailDisassociatingADoctorFromAnHospital: () ==> ()
   testFailDisassociatingADoctorFromAnHospital () == (*@\vdmnotcovered{(}@*)
   
    dcl hos1: Hospital := (*@\vdmnotcovered{new}@*) Hospital((*@\vdmnotcovered{"Hospital Sao Joao"}@*),(*@\vdmnotcovered{mk\_ModelUtils`Location}@*)("Porto", (*@\vdmnotcovered{"Alameda Prof. Hernâni Monteiro"}@*),"4200-319"), (*@\vdmnotcovered{\{}@*)(*@\vdmnotcovered{<ADSE>}@*),(*@\vdmnotcovered{<MEDICARE>}@*)});
   
    dcl doc2: Doctor := (*@\vdmnotcovered{new}@*) (*@\vdmnotcovered{Doctor}@*)("marcelo", 40 ,(*@\vdmnotcovered{<CARDIOLOGIA>}@*));
    
    (*@\vdmnotcovered{safetyNet}@*).clearInstance();
    
    safetyNet := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
    -- you can not remove a doctor from an hospital if previously that doctor was not associated to that hospital
    safetyNet.disassociateDoctorFromHospital((*@\vdmnotcovered{hos1}@*).(*@\vdmnotcovered{getId}@*)(), (*@\vdmnotcovered{doc2}@*).(*@\vdmnotcovered{getId}@*)());
   
    (*@\vdmnotcovered{safetyNet}@*).clearInstance();
   );
 
 
 public testFailCreatingAnAppointment: () ==> ()
  testFailCreatingAnAppointment () == (*@\vdmnotcovered{(}@*)
   dcl hos1: Hospital := new Hospital("Hospital Sao Joao",mk_ModelUtils`Location("Porto", "Alameda Prof. Hernâni Monteiro","4200-319"), {(*@\vdmnotcovered{<ADSE>}@*),(*@\vdmnotcovered{<MEDICARE>}@*)});
  
  dcl doc1: Doctor := new Doctor("jose",35,(*@\vdmnotcovered{<ORTOPEDIA>}@*));
  
  dcl pat1: Patient := new (*@\vdmnotcovered{Patient}@*)((*@\vdmnotcovered{"Susana"}@*), (*@\vdmnotcovered{26}@*), (*@\vdmnotcovered{"Gripe"}@*));
  dcl pat2: Patient := new Patient((*@\vdmnotcovered{"Maria"}@*), 38, (*@\vdmnotcovered{"Doença pulmonar"}@*));
  
  dcl app1: Appointment;
  dcl app2: Appointment;
  
   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
    
   safetyNet := (*@\vdmnotcovered{SafetyNetNetwork`getInstance}@*)();
   
   safetyNet.addHospital((*@\vdmnotcovered{hos1}@*));
    
  safetyNet.addDoctor((*@\vdmnotcovered{doc1}@*));
  
  (*@\vdmnotcovered{safetyNet}@*).addPatient((*@\vdmnotcovered{pat1}@*));
  (*@\vdmnotcovered{safetyNet}@*).addPatient((*@\vdmnotcovered{pat2}@*));

  safetyNet.associateDoctorToHospital(hos1.(*@\vdmnotcovered{getId}@*)(), (*@\vdmnotcovered{doc1}@*).(*@\vdmnotcovered{getId}@*)());

  app1 := new Appointment((*@\vdmnotcovered{mk\_ModelUtils`Date}@*)(2018,12,21,8,30), hos1.(*@\vdmnotcovered{getId}@*)(), doc1.getId(), (*@\vdmnotcovered{pat1}@*).(*@\vdmnotcovered{getId}@*)());
  app2 := new Appointment(mk_ModelUtils`Date(2018,12,21,8,30), hos1.getId(), doc1.getId(), (*@\vdmnotcovered{pat2}@*).(*@\vdmnotcovered{getId}@*)());

  -- a doctor and a patient can not have overlapped appointments
  (*@\vdmnotcovered{safetyNet}@*).addAppointment((*@\vdmnotcovered{app1}@*));
  (*@\vdmnotcovered{safetyNet}@*).addAppointment((*@\vdmnotcovered{app2}@*));

   (*@\vdmnotcovered{safetyNet}@*).clearInstance();
  
  )
 
functions

traces

end SystemTest
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[main:13]{main} & 13&100.0\% & 13 \\
\hline
\hyperref[testAddAgreement:784]{testAddAgreement} & 784&100.0\% & 1 \\
\hline
\hyperref[testAddAppointment:557]{testAddAppointment} & 557&100.0\% & 1 \\
\hline
\hyperref[testAddDoctor:137]{testAddDoctor} & 137&100.0\% & 1 \\
\hline
\hyperref[testAddHospital:215]{testAddHospital} & 215&100.0\% & 1 \\
\hline
\hyperref[testAddObservation:825]{testAddObservation} & 825&100.0\% & 1 \\
\hline
\hyperref[testAddPatient:515]{testAddPatient} & 515&100.0\% & 1 \\
\hline
\hyperref[testAssociateDoctorToAnHospital:252]{testAssociateDoctorToAnHospital} & 252&100.0\% & 3 \\
\hline
\hyperref[testCanNotRemoveAnAgreement:1020]{testCanNotRemoveAnAgreement} & 1020&100.0\% & 1 \\
\hline
\hyperref[testDisassociateDoctorToAnHospital:282]{testDisassociateDoctorToAnHospital} & 282&100.0\% & 1 \\
\hline
\hyperref[testFailCanNotRemoveAnAgreement:1020]{testFailCanNotRemoveAnAgreement} & 1020&0.0\% & 0 \\
\hline
\hyperref[testFailCreatingAnAppointment:1077]{testFailCreatingAnAppointment} & 1077&0.0\% & 0 \\
\hline
\hyperref[testFailDisassoatingADoctorFromAnHospital:1053]{testFailDisassoatingADoctorFromAnHospital} & 1053&0.0\% & 0 \\
\hline
\hyperref[testFailDisassociatingADoctorFromAnHospital:1053]{testFailDisassociatingADoctorFromAnHospital} & 1053&0.0\% & 0 \\
\hline
\hyperref[testFailForgotToAddDoctor:983]{testFailForgotToAddDoctor} & 983&0.0\% & 0 \\
\hline
\hyperref[testFailForgotToAddHospital:1001]{testFailForgotToAddHospital} & 1001&0.0\% & 0 \\
\hline
\hyperref[testFailSearchForADoctor:1039]{testFailSearchForADoctor} & 1039&0.0\% & 0 \\
\hline
\hyperref[testForgotToAddHospital:1001]{testForgotToAddHospital} & 1001&100.0\% & 1 \\
\hline
\hyperref[testForogotToAddDoctor:980]{testForogotToAddDoctor} & 980&100.0\% & 2 \\
\hline
\hyperref[testGetAllDoctors:163]{testGetAllDoctors} & 163&100.0\% & 1 \\
\hline
\hyperref[testGetAllHospitals:375]{testGetAllHospitals} & 375&100.0\% & 1 \\
\hline
\hyperref[testGetDoctorById:495]{testGetDoctorById} & 495&100.0\% & 3 \\
\hline
\hyperref[testGetDoctorBySpecialtie:444]{testGetDoctorBySpecialtie} & 444&100.0\% & 1 \\
\hline
\hyperref[testGetDoctorHospitals:413]{testGetDoctorHospitals} & 413&100.0\% & 2 \\
\hline
\hyperref[testGetHospitalBySpecialtie:282]{testGetHospitalBySpecialtie} & 282&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalClosestAvailableDate:904]{testGetHospitalClosestAvailableDate} & 904&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalSpecialties:465]{testGetHospitalSpecialties} & 465&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalsByAgreement:334]{testGetHospitalsByAgreement} & 334&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalsById:355]{testGetHospitalsById} & 355&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalsByLocation:315]{testGetHospitalsByLocation} & 315&100.0\% & 1 \\
\hline
\hyperref[testGetHospitalsByName:393]{testGetHospitalsByName} & 393&100.0\% & 1 \\
\hline
\hyperref[testGetNextAppointmentDate:964]{testGetNextAppointmentDate} & 964&100.0\% & 1 \\
\hline
\hyperref[testGetPatientById:601]{testGetPatientById} & 601&100.0\% & 1 \\
\hline
\hyperref[testGetSpecialtyAppointments:850]{testGetSpecialtyAppointments} & 850&100.0\% & 12 \\
\hline
\hyperref[testRemoveAgreement:805]{testRemoveAgreement} & 805&100.0\% & 1 \\
\hline
\hyperref[testRemoveAppointment:664]{testRemoveAppointment} & 664&100.0\% & 1 \\
\hline
\hyperref[testRemoveDoctor:182]{testRemoveDoctor} & 182&100.0\% & 1 \\
\hline
\hyperref[testRemoveHospital:232]{testRemoveHospital} & 232&100.0\% & 1 \\
\hline
\hyperref[testRemovePatient:538]{testRemovePatient} & 538&100.0\% & 1 \\
\hline
\hline
SystemTest.vdmpp & & 93.2\% & 61 \\
\hline
\end{longtable}

