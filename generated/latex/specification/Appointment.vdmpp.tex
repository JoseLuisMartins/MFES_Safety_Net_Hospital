\begin{vdmpp}[breaklines=true]
class Appointment
values 
 public APPOINTMENT_TIME_MIN = 30; -- duration of an appointment in minutes
instance variables
 private date : ModelUtils`Date;
  private hospitalId: nat;
  private doctorId: nat;
  private patientId: nat;
  
  -- inv 
 inv hospitalId in set dom SafetyNetNetwork`getInstance().getHospitals() and   -- |
    doctorId in set dom SafetyNetNetwork`getInstance().getDoctors() and       -- |Check if they are in the network
    patientId in set dom SafetyNetNetwork`getInstance().getPatients() and     -- |
    doctorId in set SafetyNetNetwork`getInstance().getHospitals()(hospitalId).getDoctorsIds(); --check if the doctor works in that hospital
    
operations
 --constructor
(*@
\label{Appointment:18}
@*)
 public Appointment: ModelUtils`Date * nat * nat * nat ==> Appointment
 Appointment(d,hos, doc, pat) == (
  atomic (
   date := d;
   hospitalId := hos;
   doctorId := doc;
   patientId:= pat;
  );
  return self;
 );

  --get appointment date
(*@
\label{getDate:30}
@*)
  public pure getDate: () ==> ModelUtils`Date
  getDate() == (
   return date
  );
    
  --get appointment hospital
(*@
\label{getHospitalId:36}
@*)
  public pure getHospitalId: () ==> nat
  getHospitalId() == (
   return hospitalId
  );
  
  --get appointment doctor
(*@
\label{getDoctorId:42}
@*)
  public pure getDoctorId: () ==> nat
  getDoctorId() == (
   return doctorId
  );
 
  --get appointment patient
(*@
\label{getPatientId:48}
@*)
  public pure getPatientId: () ==> nat
  getPatientId() == (
   return patientId
  );
  
functions
 --checks if two dates are equal
(*@
\label{appointmentDatesDontOverlap:55}
@*)
 static public appointmentDatesDontOverlap: ModelUtils`Date * ModelUtils`Date -> bool
 appointmentDatesDontOverlap(d1,d2) == (
  (ModelUtils`dateToNat(getNextAppointmentDate(d1)) <= ModelUtils`dateToNat(d2)) or
  (ModelUtils`dateToNat(getNextAppointmentDate(d2)) <= ModelUtils`dateToNat(d1)) 
 );
 
 --get next appointment slot date
(*@
\label{getNextAppointmentDate:62}
@*)
 static public getNextAppointmentDate: ModelUtils`Date -> ModelUtils`Date
 getNextAppointmentDate(d) == (

  if(d.month = 12 and d.day=30 and d.hour = 23 and d.min >= (ModelUtils`HOUR_MIN - APPOINTMENT_TIME_MIN)) then
   mk_ModelUtils`Date(d.year + 1, 1, 1, 00, (d.min + APPOINTMENT_TIME_MIN) mod ModelUtils`HOUR_MIN)
  elseif(d.day=30 and d.hour = 23 and d.min >= (ModelUtils`HOUR_MIN - APPOINTMENT_TIME_MIN)) then
   mk_ModelUtils`Date(d.year, d.month + 1, 1, 00, (d.min + APPOINTMENT_TIME_MIN) mod ModelUtils`HOUR_MIN)
  elseif (d.hour = 23 and d.min >= (ModelUtils`HOUR_MIN - APPOINTMENT_TIME_MIN)) then
   mk_ModelUtils`Date(d.year, d.month, d.day+1, 00, (d.min + APPOINTMENT_TIME_MIN) mod ModelUtils`HOUR_MIN)
  elseif (d.min >= (ModelUtils`HOUR_MIN - APPOINTMENT_TIME_MIN)) then
   mk_ModelUtils`Date(d.year, d.month, d.day, d.hour + 1, (d.min + APPOINTMENT_TIME_MIN) mod ModelUtils`HOUR_MIN)
  else
   mk_ModelUtils`Date(d.year, d.month, d.day, d.hour, d.min + APPOINTMENT_TIME_MIN)
 );
 
 
end Appointment
\end{vdmpp}
\bigskip
\begin{longtable}{|l|r|r|r|}
\hline
Function or operation & Line & Coverage & Calls \\
\hline
\hline
\hyperref[Appointment:18]{Appointment} & 18&100.0\% & 307 \\
\hline
\hyperref[appointmentDatesDontOverlap:55]{appointmentDatesDontOverlap} & 55&100.0\% & 282 \\
\hline
\hyperref[getDate:30]{getDate} & 30&100.0\% & 1466 \\
\hline
\hyperref[getDoctorId:42]{getDoctorId} & 42&100.0\% & 2721 \\
\hline
\hyperref[getHospitalId:36]{getHospitalId} & 36&100.0\% & 483 \\
\hline
\hyperref[getNextAppointmentDate:62]{getNextAppointmentDate} & 62&100.0\% & 655 \\
\hline
\hyperref[getPatientId:48]{getPatientId} & 48&100.0\% & 1661 \\
\hline
\hline
Appointment.vdmpp & & 100.0\% & 7575 \\
\hline
\end{longtable}

